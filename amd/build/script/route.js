/**
 * @license text 2.0.14 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/text/LICENSE
 */

define("mmPromise/mmPromise",["avalon"],function(e){function t(e){return e}function n(e){throw e}function a(e){return this.then(e,n)}function r(e){return this.then(t,e)}function o(){var e={};return e.promise=new this(function(t,n){e.resolve=t,e.reject=n}),e}function i(e,t){if("boolean"==typeof e.async)var n=e.async;else n=e.async=!0;n?window.setTimeout(t,0):t()}function s(e,t){if("pending"===e._state)if(t&&"function"==typeof t.then){var n=t instanceof p?"_then":"then";t[n](function(t){c(e,t,!0)},function(t){c(e,t,!1)})}else c(e,t,!0)}function l(e,t){"pending"===e._state&&c(e,t,!1)}function c(e,t,n){e._fired=!0,e._value=t,e._state=n?"fulfilled":"rejected",i(e,function(){e._callbacks.forEach(function(t){e._fire(t.onSuccess,t.onFail)})})}function u(e,t){t=Array.isArray(t)?t:[];var n,a=0,r=[];return new p(function(o,i){function s(s,l){s.then(function(i){n||(r[l]=i,a++,(e||a>=t.length)&&(o(e?i:r),n=!0))},function(e){n=!0,i(e)})}t.length||o();for(var l=0,c=t.length;c>l;l++)s(t[l],l)})}var p=function(e){this._callbacks=[];var t=this;if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");e(function(e){s(t,e)},function(e){l(t,e)})};p.resolve=function(e){return new p(function(t){t(e)})},p.reject=function(e){return new p(function(t,n){n(e)})},p.prototype={constructor:p,_state:"pending",_fired:!1,_fire:function(e,t){if("rejected"===this._state){if("function"!=typeof t)throw this._value;t(this._value)}else"function"==typeof e&&e(this._value)},_then:function(e,t){if(this._fired){var n=this;i(n,function(){n._fire(e,t)})}else this._callbacks.push({onSuccess:e,onFail:t})},then:function(e,a){e="function"==typeof e?e:t,a="function"==typeof a?a:n;var r=this,o=new p(function(t,n){r._then(function(a){try{a=e(a)}catch(r){return void n(r)}t(a)},function(e){try{e=a(e)}catch(r){return void n(r)}t(e)})});for(var i in r)f[i]||(o[i]=r[i]);return o},done:a,"catch":r,fail:r};var f={_state:1,_fired:1,_value:1,_callbacks:1};p.all=function(e){return u(!1,e)},p.race=function(e){return u(!0,e)},p.defer=o,e.Promise=p;var h=window.Promise;return/native code/.test(h)&&(h.prototype.done=a,h.prototype.fail=r,h.defer||(h.defer=o)),window.Promise=h||p}),define("mmRouter/mmHistory",["avalon"],function(e){function t(e){return!e||e===window.name||"_self"===e||"top"===e&&window==window.top?!0:!1}function n(e){for(var t,n=0;t=e[n++];)if("A"===t.nodeName)return t}function a(e,t){(t=document.getElementById(e))?t.scrollIntoView():(t=n(document.getElementsByName(e)))?t.scrollIntoView():window.scrollTo(0,0)}var r=document.createElement("a"),o=e.History=function(){this.location=location};o.started=!1,o.IEVersion=function(){var e=document.documentMode;return e?e:window.XMLHttpRequest?7:6}(),o.defaults={basepath:"/",html5Mode:!1,hashPrefix:"!",iframeID:null,interval:50,fireAnchor:!0};var i=window.VBArray&&o.IEVersion<=7,s=!!window.history.pushState,l=!(!("onhashchange"in window)||window.VBArray&&i);return o.prototype={constructor:o,getFragment:function(e){return null==e&&(e="popstate"===this.monitorMode?this.getPath():this.getHash()),e.replace(/^[#\/]|\s+$/g,"")},getHash:function(e){var t=(e||this).location.href;return this._getHash(t.slice(t.indexOf("#")))},_getHash:function(e){return 0===e.indexOf("#/")?decodeURIComponent(e.slice(2)):0===e.indexOf("#!/")?decodeURIComponent(e.slice(3)):""},getPath:function(){var e=decodeURIComponent(this.location.pathname+this.location.search),t=this.basepath.slice(0,-1);return e.indexOf(t)||(e=e.slice(t.length)),e.slice(1)},_getAbsolutePath:function(e){return e.hasAttribute?e.href:e.getAttribute("href",4)},start:function(t){function n(e){var t=a.iframe;if("iframepoll"===a.monitorMode&&!t)return!1;var n,r=a.getFragment();if(t){var o=a.getHash(t);r!==a.fragment?(a._setIframeHistory(a.prefix+r),n=r):o!==a.fragment&&(a.location.hash=a.prefix+o,n=o)}else r!==a.fragment&&(n=r);void 0!==n&&(a.fragment=n,a.fireRouteChange(n,{fromHistory:!0}))}if(o.started)throw new Error("avalon.history has already been started");o.started=!0,this.options=e.mix({},o.defaults,t),this.html5Mode=!!this.options.html5Mode,this.monitorMode=this.html5Mode?"popstate":"hashchange",s||(this.html5Mode&&(e.log("如果浏览器不支持HTML5 pushState，强制使用hash hack!"),this.html5Mode=!1),this.monitorMode="hashchange"),l||(this.monitorMode="iframepoll"),this.prefix="#"+this.options.hashPrefix+"/",this.basepath=("/"+this.options.basepath+"/").replace(/^\/+|\/+$/g,"/"),this.fragment=this.getFragment(),r.href=this.basepath,this.rootpath=this._getAbsolutePath(r);var a=this,i="<!doctype html><html><body>@</body></html>";switch(this.options.domain&&(i=i.replace("<body>","<script>document.domain ="+this.options.domain+"</script><body>")),this.iframeHTML=i,"iframepoll"===this.monitorMode&&e.ready(function(){if(!a.iframe){var e=a.iframe||document.getElementById(a.iframeID)||document.createElement("iframe");e.src="javascript:0",e.style.display="none",e.tabIndex=-1,document.body.appendChild(e),a.iframe=e.contentWindow,a._setIframeHistory(a.prefix+a.fragment)}}),this.monitorMode){case"popstate":this.checkUrl=e.bind(window,"popstate",n),this._fireLocationChange=n;break;case"hashchange":this.checkUrl=e.bind(window,"hashchange",n);break;case"iframepoll":this.checkUrl=setInterval(n,this.options.interval)}e.ready(function(){a.fireRouteChange(a.fragment||"/",{replace:!0})})},fireRouteChange:function(t,n){var r=e.router;r&&r.navigate&&(r.setLastPath(t),r.navigate("/"===t?t:"/"+t,n)),this.options.fireAnchor&&a(t.replace(/\?.*/g,""))},stop:function(){e.unbind(window,"popstate",this.checkUrl),e.unbind(window,"hashchange",this.checkUrl),clearInterval(this.checkUrl),o.started=!1},updateLocation:function(e,t,n){var t=t||{},a=t.replace,r=t.silent;if("popstate"===this.monitorMode){var o=this.rootpath+e+(n||"");o!=this.location.href.split("#")[0]&&history[a?"replaceState":"pushState"]({path:o},document.title,o),r||this._fireLocationChange()}else{var i=this.prefix+e;r&&e!=this.getHash()&&(this._setIframeHistory(i,a),this.fragment=this._getHash(i)),this._setHash(this.location,i,a)}},_setHash:function(e,t,n){var a=e.href.replace(/(javascript:|#).*$/,"");n?e.replace(a+t):e.hash=t},_setIframeHistory:function(e,t){if(this.iframe){var n=this.iframe.document;n.open(),n.write(this.iframeHTML),n.close(),this._setHash(n.location,e,t)}}},e.history=new o,e.bind(document,"click",function(n){var a="defaultPrevented"in n?n.defaultPrevented:n.returnValue===!1;if(!(a||n.ctrlKey||n.metaKey||2===n.which)){for(var r=n.target;"A"!==r.nodeName;)if(r=r.parentNode,!r||"BODY"===r.tagName)return;if(t(r.target)){var o=i?r.getAttribute("href",2):r.getAttribute("href")||r.getAttribute("xlink:href"),s=e.history.prefix;if(null===o)return;var l=o.replace(s,"").trim();0===o.indexOf(s)&&""!==l&&(n.preventDefault(),e.router&&e.router.navigate(l))}}}),e}),define("mmRouter/mmRouter",["../mmRouter/mmHistory"],function(){function e(){var e={};"get,post,delete,put".replace(avalon.rword,function(t){e[t]=[]}),this.routingTable=e}function t(e){var t=e.split("?"),n={},a=t[0],r=t[1];if(r)for(var o,i=r.split("&"),s=i.length,l=0;s>l;l++)i[l]&&(o=i[l].split("="),n[decodeURIComponent(o[0])]=decodeURIComponent(o[1]));return{path:a,query:n}}function n(e){if("string"==typeof e)return e;var t=[];for(var n in e)"query"!=n&&t.push(n+"="+encodeURIComponent(e[n]));return t.length?"?"+t.join("&"):""}function a(e,t,n){var a=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return a;var r=n?"?":"";return a+r+"("+t+")"+r}function r(){try{return localStorage.setItem("avalon",1),localStorage.removeItem("avalon"),!0}catch(e){return!1}}function o(e){return String(e).replace(/[,;"\\=\s%]/g,function(e){return encodeURIComponent(e)})}function i(e,t){var n=new Date;n.setTime(n.getTime()+864e5),document.cookie=o(e)+"="+o(t)+";expires="+n.toGMTString()}function s(e){var t=String(document.cookie).match(new RegExp("(?:^| )"+e+"(?:(?:=([^;]*))|;|$)"))||["",""];return decodeURIComponent(t[1])}var l=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g;if(e.prototype={error:function(e){this.errorback=e},_pathToRegExp:function(e,t){for(var n,r,o,i,s=t.keys=[],c="^",u=0;n=l.exec(e);){r=n[2]||n[3],o=n[4]||("*"==n[1]?".*":"string"),i=e.substring(u,n.index);var p=this.$types[o],f={name:r};p&&(o=p.pattern,f.decode=p.decode),s.push(f),c+=a(i,o,!1),u=l.lastIndex}i=e.substring(u),c+=a(i)+(t.strict?t.last:"/?")+"$";var h="boolean"==typeof t.caseInsensitive?t.caseInsensitive:!0;return t.regexp=new RegExp(c,h?"i":void 0),t},add:function(e,t,n,a){var r=this.routingTable[e.toLowerCase()];if("/"!==t.charAt(0))throw"path必须以/开头";a=a||{},a.callback=n,t.length>2&&"/"===t.charAt(t.length-1)&&(t=t.slice(0,-1),a.last="/"),avalon.Array.ensure(r,this._pathToRegExp(t,a))},route:function(e,t,n){t=t.trim();for(var a,r=this.routingTable[e],o=0;a=r[o++];){var i=t.match(a.regexp);if(i){a.query=n||{},a.path=t,a.params={};var s=a.keys;return i.shift(),s.length&&this._parseArgs(i,a),a.callback.apply(a,i)}}this.errorback&&this.errorback()},_parseArgs:function(e,t){for(var n=t.keys,a=0,r=n.length;r>a;a++){var o=n[a],i=e[a]||"";if("function"==typeof o.decode)var s=o.decode(i);else try{s=JSON.parse(i)}catch(l){s=i}e[a]=t.params[o.name]=s}},getLastPath:function(){return s("msLastPath")},setLastPath:function(e){i("msLastPath",e)},redirect:function(e){this.navigate(e,{replace:!0})},navigate:function(e,n){var a=t(("/"!==e.charAt(0)?"/":"")+e),n=n||{};"/"===e.charAt(0)&&(e=e.slice(1)),(!avalon.state||n.silent)&&avalon.history&&avalon.history.updateLocation(e,avalon.mix({},n,{silent:!0})),n.silent||this.route("get",a.path,a.query,n)},when:function(e,t){var n=this,e=e instanceof Array?e:[e];return avalon.each(e,function(e,a){n.add("get",a,function(){var e=n.urlFormate(t,this.params,this.query);n.navigate(e.path+e.query,{replace:!0})})}),this},get:function(e,t){},urlFormate:function(e,t,a){var a=a?n(a):"",r=e.replace(l,function(e){var n=e.replace(/[\{\}]/g,"").split(":");return n=n[0]?n[0]:n[1],n in t?t[n]:""}).replace(/^\//g,"");return{path:r,query:a}},$types:{date:{pattern:"[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])",decode:function(e){return new Date(e.replace(/\-/g,"/"))}},string:{pattern:"[^\\/]*"},bool:{decode:function(e){return 0===parseInt(e,10)?!1:!0},pattern:"0|1"},"int":{decode:function(e){return parseInt(e,10)},pattern:"\\d+"}}},"get,put,delete,post".replace(avalon.rword,function(t){return e.prototype[t]=function(e,n,a){this.add(t,e,n,a)}}),r()){e.prototype.getLastPath=function(){return localStorage.getItem("msLastPath")};var c;e.prototype.setLastPath=function(e){c&&(clearTimeout(c),c=null),localStorage.setItem("msLastPath",e),c=setTimeout(function(){localStorage.removItem("msLastPath")},864e5)}}return avalon.router=new e,avalon}),define("mmRouter/mmState",["../mmPromise/mmPromise","../mmRouter/mmRouter"],function(){function e(){for(var e=I.oldNodes;e.length;){var t=e.length-1,n=e[t];n.parentNode&&n.parentNode.removeChild(n),e.splice(t,1),n=null}}function t(e,t,n){n in t&&(e[n]=t[n],delete t[n])}function n(){return document.getElementsByTagName("avalon")[0]}function a(e){var t,n=document.createDocumentFragment(),a=document.getElementById(e),r=a.eles,o=0;if(a)for(;t=r[o];)n.appendChild(t),o++;return n}function r(e,t){var n,a=document.createDocumentFragment(),r=document.getElementById(e);if(r||(r=document.createElement("div"),r.id=e,E.appendChild(r)),r.eles)avalon.each(r.eles,function(e,t){a.appendChild(t)});else{for(r.eles=[];n=t.firstChild;)a.appendChild(n),r.eles.push(n);A[e]=!0}r.appendChild(a)}function o(e,t,n,a){var o=I.lastLocal;if(o&&(t[0]||e[0])){var i=I._local,s=[];for(var l in o){var c=o[l];if(!(l in i)||i[l]!=c){if(c.$ctrl&&"$onBeforeUnload"in c.$ctrl&&c.$ctrl.$onBeforeUnload(n,a)===!1)return!1;c.element&&e[0]!=t[0]&&s.push(c)}}avalon.each(s,function(e,t){var n=t.element,a=avalon(n).data("currentCache");a&&r(a,n)}),s=null}}function i(e,t,n,a){if(n.hasClass("oni-mmRouter-slide")){var r=t.cloneNode(!0);r.setAttribute("ms-skip","true"),avalon(r).removeClass("oni-mmRouter-enter").addClass("oni-mmRouter-leave"),avalon(t).addClass("oni-mmRouter-enter"),t.parentNode.insertBefore(r,t),I.oldNodes.push(r),p("onViewEnter",a,t,r)}return t}function s(e,t){return avalon.mix(new(avalon.mix(function(){},{prototype:e})),t)}function l(e){return e instanceof Error}function c(e){if(l(e))throw e;p("onError",I,e,e&&e.state)}function u(e){var t=avalon.isFunction(e)?new Promise(e):Promise.all(e);return t}function p(e,t){return S.$fire.apply(S,arguments),avalon.state[e]?avalon.state[e].apply(t||I.currentState,[].slice.call(arguments,2)):0}function f(e,t){if(!(this instanceof f)){var n=T[e]=new f(e,t||{});return n}this.stateName=e,this.formate(t)}function h(){return this instanceof h?void(this.$vmodels=[]):new h}function d(e,t){if(!e||!t)return!1;for(var n in e)if(!(n in t)||e[n]!==t[n])return!1;for(var n in t)if(!(n in e)||e[n]!==t[n])return!1;return!0}function v(e){return T[e]}function m(e,t){var n,t=t||"ms-view";return n=e.querySelectorAll?e.querySelectorAll("["+t+"]"):Array.prototype.filter.call(e.getElementsByTagName("*"),function(e){return"string"==typeof e.getAttribute(t)})}function g(e,t,n){var a=u(function(a,r){var o="function"==typeof e?e(t):e;"string"==typeof o?a(o):(n.message="template必须对应一个字符串或一个返回字符串的函数",r(n))});return a}function y(e,t,n){var a=u(function(a,r){return"function"==typeof e&&(e=e(t)),"string"!=typeof e?(n.message="templateUrl必须对应一个URL",r(n)):avalon.templateCache[e]?a(avalon.templateCache[e]):void avalon.state.templateLoader(e,a,r,n)});return a}function w(e,t,n){var a=u(function(a,r){if("function"==typeof e){var o=e(t);o&&o.then||"string"==typeof o?a(o):(n.message="templateProvider为函数时应该返回一个Promise或thenable对象或字符串",r(n))}else e&&e.then?a(e):(n.message="templateProvider不为函数时应该对应一个Promise或thenable对象",r(n))});return a}function b(e,t,n){return e.template?g(e.template,t,n):e.templateUrl?y(e.templateUrl,t,n):e.templateProvider?w(e.templateProvider,t,n):u(function(e,t){n.message="必须存在template, templateUrl, templateProvider中的一个",t(n)})}avalon.router.route=function(e,t,n,a){t=t.trim();for(var r,o=this.routingTable[e],i=0;r=o[i++];){var s=t.match(r.regexp);if(s&&r["abstract"]!==!0){var l={params:{}};return avalon.mix(l.params,r.params),l.keys=r.keys,l.params.query=n||{},s.shift(),r.keys.length&&this._parseArgs(s,l),void(r.stateName?I.transitionTo(I.currentState,r,l.params,a):r.callback.apply(r,s))}}this.errorback&&this.errorback()};var x,C,T={};avalon.router.go=function(e,t,n){var a=I.currentState,r=f.is(e)?e:v(e),t=t||{},t=avalon.mix(!0,{},r.params,t);r&&I.transitionTo(a,r,t,n)};var S=window.$eventManager=avalon.define({$id:"$eventManager",$flag:0,uiqKey:function(){return S.$flag++,"flag"+S.$flag++}});S.$watch("onAbort",e);var I=window.mmState={prevState:NaN,currentState:NaN,activeState:NaN,oldNodes:[],query:{},popOne:function(e,t,n,a){if(I._toParams!==t)return n(!1,{type:"abort"});var r=e.pop(),o=this;if(!r)return n();if(a&&r.onBeforeExit()===!1)return n(!1);o.activeState=r.parentState||x,r.done=function(i){return r._pending=!1,r.done=null,r._local=null,i!==!1&&o.activeState?o.popOne(e,t,n,a):n(i)};var i=r.onExit();!r._pending&&r.done&&r.done(i)},pushOne:function(e,t,n,a,r){if(I._toParams!==t)return n(!1,{type:"abort"});var o=e.shift(),i=this;if(!o)return e=null,n();if(o.syncParams(t),o.onBeforeEnter()===!1)return o.syncParams(o.oldParams),n(!1);var a=s(a);i.activeState=o,o.done=function(r){if(o.done){if(o._pending=!1,o.done=null,o.visited=!0,r===!1)return n(r);var s=o.callback.apply(o,[t,a]);s.$then(function(r){avalon.mix(!0,o.oldParams,o.params),i.pushOne(e,t,n,a)})}};var l=[];avalon.each(o.keys,function(e,t){var n=t.name;l.push(o.params[n])}),o._onEnter.apply(o,l),!o._pending&&o.done&&o.done()},transitionTo:function(e,t,n,a){var r,n=n||t.params;this.activeState&&this.activeState!=this.currentState&&(avalon.log("navigating to ["+this.currentState.stateName+"] will be stopped, redirect to ["+t.stateName+"] now"),this.activeState.done&&this.activeState.done(!1),e=this.activeState,r=!0),I.oldNodes=[];var i,l,c=avalon.router.urlFormate(t.url,n,n.query),f=this,a=a||{},h=a.reload,d=e&&e.chain||[],v=t.chain,m=0,g=v[m],y=x.sourceLocal,w=[],b=[],C={},T=[].concat(d).concat(v);avalon.each(T,function(e,t){var n=t.stateUrl;n&&(t._stateUrl=n,delete t.stateUrl,n in C||(C[n]="",b.push(u(function(e,a){avalon.controller.loader(n,function(n){avalon.mix(t,n),t.initViewsConfig(),e()})}))))}),T=C=null,u(b).then(function(){if(!h)for(;g&&g===d[m]&&!g.paramsChanged(n);)y=w[m]=g._local,m++,g=v[m];for(var u=d.slice(m),b=v.slice(m),C=y;g=v[m];)y=w[m]=s(y,g.sourceLocal),m++;return I._local=y,done=function(a,r){return i?void 0:(i=!0,f.currentState=f.activeState,b=u=C=y=n=null,I.oldNodes=[],a===!1?p("onError",f,{type:"transition",message:"transitionTo "+t.stateName+" faild",error:r,fromState:e,toState:t,params:n},f.currentState):(I.lastLocal=I.currentState._local,x.fire("updateview",f.currentState,l),avalon.log("transitionTo "+t.stateName+" success"),p("onLoad",f,e,t),void 0))},t.path=("/"+c.path).replace(/^[\/]{2,}/g,"/"),h||e!==t||(l=t.paramsChanged(n))?(I.query=avalon.mix({},n.query),!a||a.confirmed||p("onBeforeUnload",f,e,t)!==!1&&o(u,b,e,t)!==!1?void(i!==!0&&(avalon.log("begin transitionTo "+t.stateName+" from "+(e&&e.stateName||"unknown")),p("onUnload",f,e,t),f.currentState=t,f.prevState=e,I._toParams=n,c&&avalon.history&&(avalon.history.updateLocation?avalon.history.updateLocation(c.path+c.query,avalon.mix({silent:!0},a),!e&&location.hash):avalon.history.navigate(c.path+c.query,avalon.mix({silent:!0},a))),p("onBegin",f,e,t),f.popOne(u,n,function(e){return e===!1?done(e):void f.pushOne(b,n,done,C,w)},!(a&&a.confirmed)))):p("onAbort",f,e,t)):t==f.activeState&&r?done():void 0},function(){throw new Error("加载stateUrl资源失败")})}},A={},E=n();avalon.bindingHandlers.view=function(e){function t(p,g,y){if(!document.contains(l))return e=n=r=c=l=o=h=t=null,!1;var w,b=o.data("statename")||"",C=v(b)||x;if(s.indexOf("@")<0&&(s+="@"+C.stateName),w=I.currentState._local&&I.currentState._local[s],(!p||w)&&f!==w){f=w,_currentState=w&&w.state;var T=o.data("viewCache"),S=o.data("currentCache");if(w?T=(w.viewCache===!1?!1:w.viewCache||T)&&s+"@"+_currentState.stateName:T&&(T=s+"@__default__"),!(w&&_currentState===g&&w.ignoreChange&&w.ignoreChange(y,s)||T&&T===S)){i(d,r,o,_currentState);var E,M=w?w.template:u;if(T&&(w?w.element=r:I.currentState._local[s]={state:I.currentState,template:u,element:r}),avalon.clearHTML(r),r.removeAttribute("ms-view"),r.setAttribute("ui-view",e.value||e.expr||""),T){if(E=A[T]?a(T):avalon.parseHTML(M),r.appendChild(E),o.data("currentCache",T),A[T])return}else r.innerHTML=M,o.data("currentCache",!1);!w&&T&&o.data("currentCache",T),avalon.each(m(r),function(e,t){avalon(t).data("statename",_currentState&&_currentState.stateName||"")}),avalon.scan(r,(w&&w.vmodels||[]).concat(n||[])),w&&w.$ctrl&&w.$ctrl.$onRendered&&w.$ctrl.$onRendered.apply(r,[w])}}}e.expr="'"+(e.expr||"")+"'";var n=e.vmodels||arguments[1],r=(I.currentState,e.element),o=avalon(r),s=(e.value||e.expr||"").replace(/['"]+/g,""),l=document.createComment("ms-view:"+s),c=r.parentNode,u=r.innerHTML,p=o.data("statename")||"",f=(v(p)||x,{}),h=r,d=r.outerHTML;r.removeAttribute("ms-view"),c.insertBefore(l,r),t("firsttime"),x.watch("updateview",function(e,n){return t.call(this,C,e,n)})},avalon.directives&&avalon.directive("view",{init:avalon.bindingHandlers.view}),avalon.state=function(e,t){var n=f(e,t);return avalon.router.get(n.url,function(e,t){var a,r,o=this,i=[],s=[],l=[];return n.resolved=u(function(e,t){a=e,r=t}),avalon.each(n.views,function(e,a){var r=o.params,c={type:"view",name:e,params:r,state:n,view:a},p=t[e]={name:e,state:n,params:n.filterParams(r),ignoreChange:"ignoreChange"in a?a.ignoreChange:o.ignoreChange,viewCache:"viewCache"in a?a.viewCache:o.viewCache},f=b(a,r,c);i.push(f),f.then(function(e){p.template=e},avalon.noop);var h,d=function(e){p.vmodels=e.$vmodels,a.$controller=p.$ctrl=e,v()},v=function(){var e=a.$controller&&a.$controller.$onEnter;if(e){var t=u(function(t,a){var o={type:"data",state:n,params:r},i=e(r,t,function(e){o.message=e,a(o)});i&&i.then?(s.push(i),i.then(function(){t(i)})):i&&i!==!0?(o.message=i,a(o)):i===C&&t()});t=t.then(function(e){avalon.isFunction(e)&&l.push(e)}),s.push(t)}};if(a.$controller&&a.cacheController!==!1)return d(a.$controller);if(a.controller)h=f.then(function(){d(avalon.controller(a.controller))});else if(a.controllerUrl)h=u(function(e,t){var n=avalon.isFunction(a.controllerUrl)?a.controllerUrl(r):a.controllerUrl;n=n instanceof Array?n:[n],avalon.controller.loader(n,function(t){f.then(function(){d(t),e()})})});else if(a.controllerProvider){var m=avalon.isFunction(a.controllerProvider)?a.controllerProvider(r):a.controllerProvider;h=u(function(e,t){m&&m.then?(s.push(m),m.then(function(t){f.then(function(){d(t),e()})},function(e){c.message=e,t(c)})):f.then(function(){d(m),e()})})}h&&h.then&&i.push(h)}),u(i).$then(function(e){n._local=t,u(s).$then(function(){avalon.each(l,function(e,t){t()}),i=s=l=null,a()})}),n.resolved},n),this},Promise.prototype.$then=function(e,t){var n=this.then(e,t);return n["catch"](c),n},avalon.state.onViewEntered=function(e,t){e!=t&&t.parentNode.removeChild(t)},avalon.state.config=function(e){return avalon.mix(avalon.state,e||{}),avalon},f.is=function(e){return e instanceof f},f.prototype={formate:function(e){avalon.mix(!0,this,e);var t=this.stateName,n=this,a=t.split("."),r=a.length-1;this.chain=[],avalon.each(a,function(e,t){if(e==r)n.chain.push(n);else{var o=a.slice(0,e+1).join("."),i=v(o);if(!i)throw new Error("必须先定义"+o);n.chain.push(i)}}),void 0===this.url&&(this["abstract"]=!0);var o=this.chain[r-1]||x;o&&(this.url=o.url+(this.url||""),this.parentState=o),this.stateUrl||this.initViewsConfig(),this._self=e,this._pending=!1,this.visited=!1,this.params=s(o&&o.params||{}),this.oldParams={},this.keys=[],this.events={}},initViewsConfig:function(){var e=this,n=this.sourceLocal={},a=this.statename,r=this.parentState;if(!this.views&&""!=a){var o={};"template,templateUrl,templateProvider,controller,controllerUrl,controllerProvider,viewCache".replace(/\w+/g,function(n){t(o,e,n)});var i="viewname"in this?this.viewname:"";this.views={},this.views[i]=o}var s={},l=this.views instanceof Array;avalon.each(this.views,function(e,t){var a=l?t.name||"":e;a.indexOf("@")<0&&(a+="@"+(r?r.stateName||"":"")),s[a]=t,n[a]={}}),this.views=s},watch:function(e,t){var n=this.events[e]||[];return this.events[e]=n,n.push(t),t},fire:function(e,t){for(var n=this.events[e]||[],a=0;n[a];){var r=n[a].apply(this,[].slice.call(arguments,1));r===!1?n.splice(a,1):a++}},unwatch:function(e,t){var n=this.events[e];if(n)for(var a=0;n[a];){if(n[a]==t)return n.splice(a,1);a++}},paramsChanged:function(e){var t=!1,n=this.keys,a=this.params;return avalon.each(n,function(n,r){var o=r.name;a[o]!=e[o]&&(t="param")}),t||I.currentState!==this||(t=!d(e.query,I.query)&&"query"),t},filterParams:function(e){var t=avalon.mix(!0,{},this.params),n=this.keys;return avalon.each(n,function(n,a){t[a.name]=e[a.name]}),t},syncParams:function(e){var t=this;avalon.each(this.keys,function(n,a){var r=a.name;r in e&&(t.params[r]=e[r])})},_onEnter:function(){this.query=this.getQuery();var e=this,t=Array.prototype.slice.call(arguments),n=e._async();u(function(a,r){var o={type:"data",state:e,params:e.params},i=function(t){o.message=t,n.apply(e,[!1]),r(o)},s=function(){n.apply(e),a()},l=e.onEnter.apply(e,t.concat([s,i]));l&&l.then?l.then(s)["catch"](c):l&&l!==!0?i(l):l===C&&s()})},getQuery:function(){return I.query},getParams:function(){return this.params},_async:function(){return this.done&&(this._pending=!0),this.done||avalon.noop},onBeforeEnter:avalon.noop,onEnter:avalon.noop,onBeforeExit:avalon.noop,onExit:avalon.noop},x=f("",{url:"",views:null,"abstract":!0}),avalon.controller=function(){var e=arguments[0],t=arguments[1];if(e&&e instanceof h)return e;var n=h();if(avalon.isFunction(e))e(n);else if(avalon.isFunction(t))n.name=e,t(n);else{if("string"!=typeof e&&"object"!=typeof e)throw new Error("参数错误"+arguments);e=e instanceof Array?e:Array.prototype.slice.call(arguments),avalon.each(e,function(t,a){"string"==typeof a&&(e[t]=avalon.vmodels[a]),a=e[t],"$onRendered"in a&&(n.$onRendered=a.$onRendered),"$onEnter"in a&&(n.$onEnter=a.$onEnter)}),n.$vmodels=e}return n},avalon.controller.loader=function(e,t){function n(e){t&&t(e)}if(e=e instanceof Array?e:[e],window.requirejs)requirejs(e,n);else if("function"==typeof require&&require.ensure)require.ensure(e,n);else{if(!avalon.require)throw Error('未能找有效的模块加载器异步加载"'+e+'"，请参照mmState.js的avalon.controller.loader源码进行修改');avalon.require(e,n)}},h.prototype={};var M=function(){return new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")};avalon.state.templateLoader=function(e,t,n,a){var r=M();r.onreadystatechange=function(){if(4===r.readyState){var o=r.status;o>399&&600>o?(a.message="templateUrl对应资源不存在或没有开启 CORS",a.status=o,a.xhr=r,n(a)):t(avalon.templateCache[e]=r.responseText)}},r.open("GET",e,!0),"withCredentials"in r&&(r.withCredentials=!0),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.send()}}),define("mmRequest/mmRequest",["avalon","../mmPromise/mmPromise"],function(avalon){function IE(){if(window.VBArray){var e=document.documentMode;return e?e:window.XMLHttpRequest?7:6}return 0}function parseJS(e){var t=eval;if(e=e.trim())if(1===e.indexOf("use strict")){var n=document.createElement("script");n.text=e,head.appendChild(n).parentNode.removeChild(n)}else t(e)}function parseXML(e,t,n){try{var a=document.documentMode;window.DOMParser&&(!a||a>8)?(n=new DOMParser,t=n.parseFromString(e,"text/xml")):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e))}catch(r){t=void 0}return t&&t.documentElement&&!t.getElementsByTagName("parsererror").length||avalon.error("Invalid XML: "+e),t}function ajaxExtend(e){e=avalon.mix({},defaults,e),e.type=e.type.toUpperCase();var t="string"==typeof e.data?e.data:avalon.param(e.data);if(e.querystring=t||"",e.url=e.url.replace(rhash,"").replace(rprotocol,location.protocol+"//"),"boolean"!=typeof e.crossDomain){var n=document.createElement("a");try{n.href=e.url;var a="1"[0]?n.href:n.getAttribute("href",4);n.href=a,e.crossDomain=originAnchor.protocol+"//"+originAnchor.host!=n.protocol+"//"+n.host}catch(r){e.crossDomain=!0}}return e.hasContent=!rnoContent.test(e.type),e.hasContent||(t&&(e.url+=(rquery.test(e.url)?"&":"?")+t),e.cache===!1&&(e.url+=(rquery.test(e.url)?"&":"?")+"_time="+(new Date-0))),e}function ok(e){return e}function ng(e){throw e}function paramInner(e,t,n){var a;if(Array.isArray(t))avalon.each(t,function(t,a){paramInner(e+"["+("object"==typeof a?t:"")+"]",a,n)});else if(avalon.isPlainObject(t))for(a in t)paramInner(e+"["+a+"]",t[a],n);else n(e,t)}function trimLine(e){return e.replace(rline,"\r\n")}var global=this||(0,eval)("this"),DOC=global.document,encode=encodeURIComponent,decode=decodeURIComponent,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rhash=/#.*$/,rquery=/\?/,rjsonp=/(=)\?(?=&|$)|\?\?/,r20=/%20/g,originAnchor=document.createElement("a");originAnchor.href=location.href;var accepts={xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",script:"text/javascript, application/javascript","*":["*/"]+["*"]},useOnload=0===IE()||IE()>8;String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.lastIndexOf(e,t)===t});var head=DOC.getElementsByTagName("head")[0],isLocal=!1;try{isLocal=rlocalProtocol.test(location.protocol)}catch(e){}!new function(){var s=["XMLHttpRequest","ActiveXObject('MSXML2.XMLHTTP.6.0')","ActiveXObject('MSXML2.XMLHTTP.3.0')","ActiveXObject('MSXML2.XMLHTTP')","ActiveXObject('Microsoft.XMLHTTP')"];s[0]=IE()<8&&0!==IE()&&isLocal?"!":s[0];for(var i=0,axo;axo=s[i++];)try{if(eval("new "+axo)){avalon.xhr=new Function("return new "+axo);break}}catch(e){}};var supportCors="withCredentials"in avalon.xhr(),defaults={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,jsonp:"callback"},XHRMethods={setRequestHeader:function(e,t){return this.requestHeaders[e]=t,this},getAllResponseHeaders:function(){return 4===this.readyState?this.responseHeadersString:null},getResponseHeader:function(e,t){if(4===this.readyState){for(;t=rheaders.exec(this.responseHeadersString);)this.responseHeaders[t[1]]=t[2];t=this.responseHeaders[e]}return void 0===t?null:t},overrideMimeType:function(e){return this.mimeType=e,this},abort:function(e){return e=e||"abort",this.transport&&this.respond(0,e),this},dispatch:function(e,t){var n=t;if(this.transport){this.readyState=4;var a=e>=200&&300>e||304===e;if(a)if(204===e)n="nocontent";else if(304===e)n="notmodified";else if("undefined"==typeof this.response){var r=this.options.dataType||this.options.mimeType;(!r&&this.responseText||this.responseXML)&&(r=this.getResponseHeader("Content-Type")||"",r=r.match(/json|xml|script|html/)||["text"],r=r[0]);var o=this.responseText||"",i=this.responseXML||"";try{this.response=avalon.ajaxConverters[r].call(this,o,i)}catch(s){a=!1,this.error=s,n="parsererror"}}this.status=e,this.statusText=n+"",this.timeoutID&&(clearTimeout(this.timeoutID),delete this.timeoutID),this._transport=this.transport,a?this._resolve([this.response,n,this]):this._reject([this,n,this.error]),delete this.transport}}};avalon.ajax=function(e,t){e&&e.url||avalon.error("参数必须为Object并且拥有url属性"),e=ajaxExtend(e);var n,a,r={responseHeadersString:"",responseHeaders:{},requestHeaders:{},querystring:e.querystring,readyState:0,uniqueID:(""+Math.random()).replace(/0\./,""),status:0},t=new avalon.Promise(function(e,t){a=e,n=t});t.options=e,t._reject=n,t._resolve=a;var o=[],i=[];Array("done","fail","always").forEach(function(e){t[e]=function(t){return"function"==typeof t&&("fail"!==e&&o.push(t),"done"!==e&&i.push(t)),this}});var s=e.async===!1;s&&(avalon.log("warnning:与jquery1.8一样,async:false这配置已经被废弃"),t.async=!1),avalon.mix(t,r,XHRMethods),t.then(function(e){e=Array.isArray(e)?e:void 0===e?[]:[e];for(var n,a=0;n=o[a++];)n.apply(t,e);return e},function(e){e=Array.isArray(e)?e:void 0===e?[]:[e];for(var n,a=0;n=i[a++];)n.apply(t,e);return e}),t.done(e.success).fail(e.error).always(e.complete);var l=e.dataType,c=avalon.ajaxTransports;(e.crossDomain&&!supportCors||rjsonp.test(e.url))&&"json"===l&&"GET"===e.type&&(l=e.dataType="jsonp");var u=e.form?"upload":l,p=c[u]||c.xhr;avalon.mix(t,p),t.preproccess&&(l=t.preproccess()||l),e.contentType&&t.setRequestHeader("Content-Type",e.contentType),t.setRequestHeader("Accept",accepts[l]?accepts[l]+", */*; q=0.01":accepts["*"]);for(var f in e.headers)t.setRequestHeader(f,e.headers[f]);return e.async&&e.timeout>0&&(t.timeoutID=setTimeout(function(){t.abort("timeout"),t.dispatch(0,"timeout")},e.timeout)),t.request(),t},"get,post".replace(avalon.rword,function(e){avalon[e]=function(t,n,a,r){return"function"==typeof n&&(r=r||a,a=n,n=void 0),avalon.ajax({type:e,url:t,data:n,success:a,dataType:r})}}),avalon.getScript=function(e,t){return avalon.get(e,null,t,"script")},avalon.getJSON=function(e,t,n){return avalon.get(e,t,n,"json")},avalon.upload=function(e,t,n,a,r){return"function"==typeof n&&(r=a,a=n,n=void 0),avalon.ajax({url:e,type:"post",dataType:r,form:t,data:n,success:a})},avalon.ajaxConverters={text:function(e){return e},xml:function(e,t){return void 0!==t?t:parseXML(e)},html:function(e){return avalon.parseHTML(e)},json:function(e){return avalon.parseJSON||avalon.log("avalon.parseJSON不存在,请升级到最新版"),avalon.parseJSON(e)},script:function(e){return parseJS(e),e},jsonp:function(){var e,t;return this.jsonpCallback.startsWith("avalon.")?(t=this.jsonpCallback.replace(/avalon\./,""),e=avalon[t],delete avalon[t]):e=window[this.jsonpCallback],e}},avalon.param=function(e){var t,n=[],a=function(e,t){t=null==t?"":t,n[n.length]=encode(e)+"="+encode(t)};if(Array.isArray(e)||!avalon.isPlainObject(e))avalon.each(e,function(e,t){a(e,t)});else for(t in e)paramInner(t,e[t],a);
return n.join("&").replace(r20,"+")},avalon.unparam=function(e){var t,n,a=/\[(.*?)\]/g,r=/(.+?)\[/,o={};return"string"!=(n=avalon.type(e))||"string"==n&&!n.length?{}:(-1!==e.indexOf("?")&&(e=e.split("?").pop()),t=decode(e).split("&"),!(n=t.length)||1==n&&""===n?o:(t.forEach(function(e){if(e.length){n=e.split("=");var t,i,s=n.shift(),l=n.join("=").replace(/\+/g," "),c=[];if(s.length){for(;n=a.exec(s);)c.push(n[1]);if(!(t=c.length))return void(o[s]=l);t--,n=r.exec(s),n&&(s=n[1])&&s.length&&("object"!==avalon.type(o[s])&&(o[s]={}),i=o[s],avalon.each(c,function(e,a){(n=a).length||(n=0,avalon.each(i,function(e){!isNaN(e)&&e>=0&&e%1===0&&e>=n&&(n=Number(e)+1)})),e==t?i[n]=l:i="object"!==avalon.type(i[n])?i[n]={}:i[n]}))}}}),o))};var rinput=/select|input|button|textarea/i,rcheckbox=/radio|checkbox/,rline=/\r?\n/g;avalon.serialize=function(e){var t={};return Array.prototype.filter.call(e.getElementsByTagName("*"),function(e){return rinput.test(e.nodeName)&&e.name&&!e.disabled?rcheckbox.test(e.type)?e.checked:!0:void 0}).forEach(function(e){var n=avalon(e).val();n=Array.isArray(n)?n.map(trimLine):trimLine(n);var a=e.name;a in t?Array.isArray(n)?t[a].push(n):t[a]=[t[a],n]:t[a]=n}),avalon.param(t,!1)};var transports=avalon.ajaxTransports={xhr:{request:function(){var e=this,t=this.options,n=this.transport=new avalon.xhr;n.open(t.type,t.url,t.async,t.username,t.password),this.mimeType&&n.overrideMimeType&&n.overrideMimeType(this.mimeType),t.crossDomain&&"withCredentials"in n&&(n.withCredentials=!0),t.crossDomain||(this.requestHeaders["X-Requested-With"]="XMLHttpRequest");for(var a in this.requestHeaders)n.setRequestHeader(a,this.requestHeaders[a]+"");if(t.progressCallback){var r=document.all&&!window.atob;r||(n.upload.onprogress=t.progressCallback)}var o=t.dataType;"responseType"in n&&/^(blob|arraybuffer|text)$/.test(o)&&(n.responseType=o,this.useResponseType=!0),n.send(t.hasContent&&(this.formdata||this.querystring)||null),t.async&&4!==n.readyState?useOnload?n.onload=n.onerror=function(t){this.readyState=4,this.status="load"===t.type?200:500,e.respond()}:n.onreadystatechange=function(){e.respond()}:this.respond()},respond:function(e,t){var n=this.transport;if(n){t&&this.timeoutID&&(clearTimeout(this.timeoutID),delete this.timeoutID);try{var a=4===n.readyState;if(t||a)if(n.onreadystatechange=avalon.noop,useOnload&&(n.onerror=n.onload=null),t)a||"function"!=typeof n.abort||n.abort();else{var r=n.status,o=n.responseText;this.responseText="string"==typeof o?o:void 0;try{var i=n.responseXML;this.responseXML=i.documentElement}catch(s){}this.useResponseType&&(this.response=n.response),this.responseHeadersString=n.getAllResponseHeaders();try{var l=n.statusText}catch(s){this.error=s,l="firefoxAccessError"}r||!isLocal||this.options.crossDomain?1223===r&&(r=204):r=this.responseText?200:404,this.dispatch(r,l)}}catch(c){t||this.dispatch(500,c)}}}},jsonp:{preproccess:function(){var e=this.options,t=this.jsonpCallback=e.jsonpCallback||"avalon.jsonp"+setTimeout("1");return rjsonp.test(e.url)?e.url=e.url.replace(rjsonp,"$1"+t):e.url=e.url+(rquery.test(e.url)?"&":"?")+e.jsonp+"="+t,t.startsWith("avalon.")?(t=t.replace(/avalon\./,""),avalon[t]=function(e){avalon[t]=e}):window[t]=function(e){window[t]=e},"script"}},script:{request:function(){var e=this.options,t=this.transport=DOC.createElement("script");e.charset&&(t.charset=e.charset);var n=this;t.onerror=t[useOnload?"onload":"onreadystatechange"]=function(){n.respond()},t.src=e.url,head.insertBefore(t,head.firstChild)},respond:function(e,t){var n=this.transport;if(n){t&&this.timeoutID&&(clearTimeout(this.timeoutID),delete this.timeoutID);var a=/loaded|complete|undefined/i.test(n.readyState);if(t||a){n.onerror=n.onload=n.onreadystatechange=null;var r=n.parentNode;if(r&&r.removeChild(n),!t){var o;if(this.jsonpCallback){var i=this.jsonpCallback.startsWith("avalon.")?avalon[this.jsonpCallback.replace(/avalon\./,"")]:window[this.jsonpCallback];o="function"==typeof i?[500,"error"]:[200,"success"]}else o=[200,"success"];this.dispatch.apply(this,o)}}}}},upload:{preproccess:function(){var e,t=this.options;"function"==typeof t.form.append?(e=t.form,t.contentType=""):e=new FormData(t.form),avalon.each(t.data,function(t,n){e.append(t,n)}),this.formdata=e}}};if(avalon.mix(transports.jsonp,transports.script),avalon.mix(transports.upload,transports.xhr),!window.FormData){var str='Function BinaryToArray(binary)\r\n                 Dim oDic\r\n                 Set oDic = CreateObject("scripting.dictionary")\r\n                 length = LenB(binary) - 1\r\n                 For i = 1 To length\r\n                     oDic.add i, AscB(MidB(binary, i, 1))\r\n                 Next\r\n                 BinaryToArray = oDic.Items\r\n              End Function';execScript(str,"VBScript"),avalon.fixAjax=function(){function e(e){var t=avalon.parseHTML("<iframe  id='"+e+"' name='"+e+"' style='position:absolute;left:-9999px;top:-9999px;'/>").firstChild;return(DOC.body||DOC.documentElement).insertBefore(t,null)}function t(e,t){var n,a,r,o,i,s=[];for(n in t)for(a=Array.isArray(t[n]),r=a?t[n]:[t[n]],o=0;o<r.length;o++)i=DOC.createElement("input"),i.type="hidden",i.name=n,i.value=r[o],e.appendChild(i),s.push(i);return s}avalon.ajaxConverters.arraybuffer=function(){var e=this.tranport&&this.tranport.responseBody;return e?new VBArray(BinaryToArray(e)).toArray():void 0},avalon.ajaxTransports.upload={request:function(){var n=this,a=this.options,r="iframe-upload-"+this.uniqueID,o=a.form,i=this.transport=e(r),s={target:o.target||"",action:o.action||"",enctype:o.enctype,method:o.method},l=a.data?t(o,a.data):[];o.target=r,o.action=a.url,o.method="POST",o.enctype="multipart/form-data",this.uploadcallback=avalon.bind(i,"load",function(e){n.respond(e)}),o.submit();for(var c in s)o[c]=s[c];l.forEach(function(e){o.removeChild(e)})},respond:function(e){var t,n=this.transport;if(n){if(e&&"load"===e.type){var a=n.contentWindow.document;this.responseXML=a,a.body&&(this.responseText=a.body.innerHTML,(t=a.body.firstChild)&&"PRE"===t.nodeName.toUpperCase()&&t.firstChild&&(this.responseText=t.firstChild.nodeValue)),this.dispatch(200,"success")}this.uploadcallback=avalon.unbind(n,"load",this.uploadcallback),delete this.uploadcallback,setTimeout(function(){n.parentNode.removeChild(n)})}}},delete avalon.fixAjax},avalon.fixAjax()}return avalon}),define("animation/avalon.animation",["avalon"],function(){function e(e){for(var n=1;n<arguments.length;n++)t(this,arguments[n]);this.duration="number"==typeof this.duration?this.duration:400,this.queue=!(null!=this.queue&&!this.queue),this.easing=avalon.easing[this.easing]?this.easing:"swing",this.update=!0,this.gotoEnd=!1}function t(e,n,a){if("slow"===n)e.duration=600;else if("fast"===n)e.duration=200;else switch(avalon.type(n)){case"object":for(var r in n)t(e,n[r],r);break;case"number":e.duration=n;break;case"string":e.easing=n;break;case"function":a=a||"complete",e.bind(a,n)}}function n(e,t){var n=[null,null],a=[null,null],r=[null,null],o=function(o,i){return r[i]=3*e[i],a[i]=3*(t[i]-e[i])-r[i],n[i]=1-r[i]-a[i],o*(r[i]+o*(a[i]+o*n[i]))},i=function(e){return r[0]+e*(2*a[0]+3*n[0]*e)},s=function(e){for(var t,n=e,a=0;++a<14&&(t=o(n,0)-e,!(Math.abs(t)<.001));)n-=t/i(n);return n};return function(e){return o(s(e),1)}}function a(e){var t=e.fps||p.fps;if(e.queue){for(var n,o=1,i=h.length;n=h[--i];)if(n.elem===e.elem){n.troops.push(e),o=0;break}o&&h.unshift(e)}else h.push(e);null===a.id&&(a.id=setInterval(r,1e3/t))}function r(){for(var e=h.length;--e>=0;)h[e].paused||h[e].elem&&o(h[e],e)||h.splice(e,1);h.length||(clearInterval(a.id),a.id=null)}function o(e,t){var n=+new Date;if(e.startTime){var a=(n-e.startTime)/e.duration,r=e.gotoEnd||a>=1;if(e.update){for(var o,i=0;o=e.tweens[i++];)o.run(a,r);e.fire("step",e)}if(r)if(e.fire("after",e),e.fire("complete",e),e.revert)this.revertTweens(),delete this.startTime,this.gotoEnd=!1;else{var s=e.troops.shift();if(!s)return!1;h[t]=s,s.troops=e.troops}}else{e.fire("before",e);var l=e.elem;"none"!==avalon.css(l,"display")||l.dataShow||e.build(),e.createTweens(),e.build(),e.fire("afterBefore",e),e.startTime=n}return!0}function i(e){this.$events={},this.elem=e,this.troops=[],this.tweens=[],this.orig=[],this.props={},this.dataShow={}}function s(e,t,n,a){var r,o=e.elem,i=o.dataShow||{},s=new l(t,e),c=i[t]||s.cur();if(/color$/i.test(t))parts=[u(c),u(n)];else{parts=v.exec(c);var p=parts&&parts[3]||(avalon.cssNumber[t]?"":"px");if("toggle"===n&&(n=a?"show":"hide"),"show"===n)e.showState="show",avalon.css(o,t,0),parts=[0,parseFloat(c)];else if("hide"===n)e.showState="hide",e.orig[t]=c,parts=[parseFloat(c),0],n=0;else if(parts=v.exec(n),parts){if(parts[2]=parseFloat(parts[2]),parts[3]&&parts[3]!==p){var f=o.cloneNode(!0);f.style.visibility="hidden",f.style.position="absolute",o.parentNode.appendChild(f),avalon.css(f,t,parts[2]+(parts[3]?parts[3]:0)),parts[2]=parseFloat(avalon.css(f,t)),o.parentNode.removeChild(f)}r=parts[2],c=parseFloat(c),parts[1]&&(r=c+(parts[1]+1)*parts[2]),parts=[c,r]}}c=parts[0],r=parts[1],c+""!=r+""?(s.start=c,s.end=r,s.unit=p,e.tweens.push(s)):delete e.props[t]}function l(e,t){this.elem=t.elem,this.prop=e,this.easing=avalon.easing[t.easing],/color$/i.test(e)&&(this.update=this.updateColor)}function c(e,t){var n={};return m.concat.apply([],m.slice(0,t)).forEach(function(t){n[t]=e,~t.indexOf("margin")&&(l.propHooks[t]={get:l.propHooks._default.get,set:function(e){e.elem.style[e.name]=Math.max(e.now,0)+e.unit}})}),n}function u(e){var t=e.toLowerCase(),n=[];if(y[t])return y[t];if(0===t.indexOf("rgb")){var a=t.match(/(\d+%?)/g),r=-1!==a[0].indexOf("%")?2.55:1;return y[t]=[parseInt(a[0])*r,parseInt(a[1])*r,parseInt(a[2])*r]}return"#"===t.charAt(0)?(4===t.length&&(t=t.replace(/([^#])/g,"$1$1")),t.replace(/\w{2}/g,function(e){n.push(parseInt(e,16))}),y[t]=n):window.VBArray?y[t]=w(t):y.white}var p=avalon.fn.animate=function(t,n){var r=new i(this[0]);if("number"==typeof t)r.duration=t;else if("object"==typeof t){for(var o in t){var s=avalon.cssName(o)||o;o!==s&&(t[s]=t[o],delete t[o])}r.props=t}return e.apply(r,arguments),a(r),this};avalon.mix(p,{fps:30});var f={linear:[.25,.25,.75,.75],ease:[.25,.1,.25,1],easeIn:[.42,0,1,1],easeOut:[0,0,.58,1],easeInOut:[.42,0,.58,1],easeInQuad:[.55,.085,.68,.53],easeInCubic:[.55,.055,.675,.19],easeInQuart:[.895,.03,.685,.22],easeInQuint:[.755,.05,.855,.06],easeInSine:[.47,0,.745,.715],easeInExpo:[.95,.05,.795,.035],easeInCirc:[.6,.04,.98,.335],easeInBack:[.6,-.28,.735,.045],easeOutQuad:[.25,.46,.45,.94],easeOutCubic:[.215,.61,.355,1],easeOutQuart:[.165,.84,.44,1],easeOutQuint:[.23,1,.32,1],easeOutSine:[.39,.575,.565,1],easeOutExpo:[.19,1,.22,1],easeOutCirc:[.075,.82,.165,1],easeOutBack:[.175,.885,.32,1.275],easeInOutQuad:[.455,.03,.515,.955],easeInOutCubic:[.645,.045,.355,1],easeInOutQuart:[.77,0,.175,1],easeInOutQuint:[.86,0,.07,1],easeInOutSine:[.445,.05,.55,.95],easeInOutExpo:[1,0,0,1],easeInOutCirc:[.785,.135,.15,.86],easeInOutBack:[.68,-.55,.265,1.55],custom:[0,.35,.5,1.3],random:[Math.random().toFixed(3),Math.random().toFixed(3),Math.random().toFixed(3),Math.random().toFixed(3)]};avalon.easing={linear:function(e){return e},swing:function(e){return-Math.cos(e*Math.PI)/2+.5}},avalon.each(f,function(e,t){avalon.easing[e]=n([t[0],t[1]],[t[2],t[3]])});var h=avalon.timeline=[];a.id=null;var d=document.documentElement;avalon.isHidden=function(e){return 0===e.sourceIndex||"none"===avalon.css(e,"display")||!avalon.contains(d,e)},i.prototype={constructor:i,bind:function(e,t,n){var a=this.$events[e]||(this.$events[e]=[]),r=n?"unshift":"push";a[r](t)},fire:function(e){for(var t,n=Array.prototype.slice.call(arguments,1),a=this.$events[e]||[],r=0;t=a[r++];)t.call(this.elem,n)},build:function(){var e=this,t=e.elem,n=e.props,a=t.style,r=!window.getComputedStyle;if(1===t.nodeType&&("height"in n||"width"in n||"show"===e.showState)){e.overflow=[a.overflow,a.overflowX,a.overflowY];var o=a.display||avalon.css(t,"display"),i=t.getAttribute("olddisplay");i?"none"!==o?t.setAttribute("olddisplay",o):o=i:("none"===o&&(a.display="",o=avalon.css(t,"display"),"none"===o&&(o=avalon.parseDisplay(t.nodeName))),t.setAttribute("olddisplay",o)),a.display=o,"inline"===o&&"none"===avalon.css(t,"float")&&(r&&"inline"!==avalon.parseDisplay(t.nodeName)?a.zoom=1:a.display="inline-block")}e.overflow&&(a.overflow="hidden",e.bind("after",function(){a.overflow=e.overflow[0],a.overflowX=e.overflow[1],a.overflowY=e.overflow[2],e.overflow=null})),e.bind("after",function(){if("hide"===e.showState){t.setAttribute("olddisplay",avalon.css(t,"display")),this.style.display="none",this.dataShow={};for(var n in e.orig)this.dataShow[n]=e.orig[n],avalon.css(this,n,e.orig[n])}}),this.build=avalon.noop},createTweens:function(){var e=avalon.isHidden(this.elem);for(var t in this.props)s(this,t,this.props[t],e)},revertTweens:function(){for(var e,t=0;e=this.tweens[t++];){var n=e.start,a=e.end;e.start=a,e.end=n,this.props[e.name]=Array.isArray(e.start)?"rgb("+e.start+")":e.unit?e.start+e.unit:e.start}this.revert=!this.revert}};var v=new RegExp("^(?:([+-])=|)("+/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source+")([a-z%]*)$","i");l.prototype={constructor:l,cur:function(){var e=l.propHooks[this.prop];return e&&e.get?e.get(this):l.propHooks._default.get(this)},run:function(e,t){this.update(e,t);var n=l.propHooks[this.prop];n&&n.set?n.set(this):l.propHooks._default.set(this)},updateColor:function(e,t){if(t)var n=this.end;else{var a=this.easing(e);n=this.start.map(function(e,t){return Math.max(Math.min(parseInt(e+(this.end[t]-e)*a,10),255),0)},this)}this.now="rgb("+n+")"},update:function(e,t){this.now=t?this.end:this.start+this.easing(e)*(this.end-this.start)}},l.propHooks={_default:{get:function(e){var t=avalon.css(e.elem,e.prop);return t&&"auto"!==t?t:0},set:function(e){avalon.css(e.elem,e.prop,e.now+(e.unit||""))}}},avalon.each(["scrollTop","scollLeft"],function(e){l.propHooks[e]={get:function(e){return e.elem[e.name]},set:function(e){e.elem[e.name]=e.now}}}),avalon.fn.mix({delay:function(e){return this.animate(e)},pause:function(){for(var e,t=this[0],n=0;e=h[n];n++)e.elem===t&&(e.paused=new Date-0);return this},resume:function(){for(var e,t=new Date,n=this[0],a=0;e=h[a];a++)e.elem===n&&e.paused&&(e.startTime+=t-e.paused,delete e.paused);return this},stop:function(e,t){e=e?"1":"",t=t?"1":"0";for(var n,a=parseInt(e+t,2),r=this[0],o=0;n=h[o];o++)if(n.elem===r)switch(n.gotoEnd=!0,a){case 0:n.update=n.revert=!1;break;case 1:n.revert=!1;break;case 2:delete n.elem;break;case 3:n.troops.forEach(function(e){e.gotoEnd=!0})}return this}});var m=[["height","marginTop","marginBottom","borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],["width","marginLeft","marginRight","borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],["opacity"]],g={slideDown:c("show",1),slideUp:c("hide",1),slideToggle:c("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}};avalon.each(g,function(e,t){avalon.fn[e]=function(){var e=[].concat.apply([t],arguments);return this.animate.apply(this,e)}}),String("toggle,show,hide").replace(avalon.rword,function(e){avalon.fn[e]=function(){var t=[].concat.apply([c(e,3)],arguments);return this.animate.apply(this,t)}});var y={black:[0,0,0],gray:[128,128,128],white:[255,255,255],orange:[255,165,0],red:[255,0,0],green:[0,128,0],yellow:[255,255,0],blue:[0,0,255]};if(window.VBArray)var w=new function(){var e;try{var t=new ActiveXObject("htmlfile");t.write("<body>"),t.close(),e=t.body}catch(n){e=createPopup().document.body}var a=e.createTextRange();return function(t){e.style.color=String(t).trim();var n=a.queryCommandValue("ForeColor");return[255&n,(65280&n)>>8,(16711680&n)>>16]}};return avalon.parseColor=u,avalon}),define("route",["./mmRouter/mmState","./mmRequest/mmRequest","./animation/avalon.animation"],function(){var e=avalon.define({$id:"root",page:""});return avalon.state("blog",{url:"/","abstract":!0,stateUrl:"./controller/stateBlog"}).state("blog.list",{url:"{pageId}",stateUrl:"./controller/stateList"}).state("blog.detail",{url:"detail/{blogId}",stateUrl:"./controller/stateDetail"}).state("blog.detail.comment",{views:{"":{templateUrl:"./script/template/comment.html"}}}),avalon.state.config({onError:function(){console.log(arguments)},onLoad:function(){e.page=mmState.currentState.stateName.split(".")[1]},onViewEnter:function(e,t){avalon(t).animate({marginLeft:"-100%"},500,"easein",function(){t.parentNode&&t.parentNode.removeChild(t)})}}),{init:function(){avalon.history.start({fireAnchor:!1}),avalon.scan()}}}),define("text",["module"],function(e){"use strict";var t,n,a,r,o,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,u=c&&location.protocol&&location.protocol.replace(/\:/,""),p=c&&location.hostname,f=c&&(location.port||void 0),h={},d=e.config&&e.config()||{};return t={version:"2.0.14",strip:function(e){if(e){e=e.replace(s,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=i[t];try{e=new ActiveXObject(n)}catch(a){}if(e){i=[n];break}}return e},parseName:function(e){var t,n,a,r=!1,o=e.lastIndexOf("."),i=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!i||o>1)?(t=e.substring(0,o),n=e.substring(o+1)):t=e,a=n||t,o=a.indexOf("!"),-1!==o&&(r="strip"===a.substring(o+1),a=a.substring(0,o),n?n=a:t=a),{moduleName:t,ext:n,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,a,r){var o,i,s,l=t.xdRegExp.exec(e);return l?(o=l[2],i=l[3],i=i.split(":"),s=i[1],i=i[0],!(o&&o!==n||i&&i.toLowerCase()!==a.toLowerCase()||(s||i)&&s!==r)):!0},finishLoad:function(e,n,a,r){a=n?t.strip(a):a,d.isBuild&&(h[e]=a),r(a)},load:function(e,n,a,r){if(r&&r.isBuild&&!r.inlineText)return void a();d.isBuild=r&&r.isBuild;var o=t.parseName(e),i=o.moduleName+(o.ext?"."+o.ext:""),s=n.toUrl(i),l=d.useXhr||t.useXhr;return 0===s.indexOf("empty:")?void a():void(!c||l(s,u,p,f)?t.get(s,function(n){t.finishLoad(e,o.strip,n,a)},function(e){a.error&&a.error(e)}):n([i],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,a)}))},write:function(e,n,a,r){if(h.hasOwnProperty(n)){var o=t.jsEscape(h[n]);a.asModule(e+"!"+n,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,n,a,r,o){var i=t.parseName(n),s=i.ext?"."+i.ext:"",l=i.moduleName+s,c=a.toUrl(i.moduleName+s)+".js";t.load(l,a,function(n){var a=function(e){return r(c,e)};a.asModule=function(e,t){return r.asModule(e,c,t)},t.write(e,l,a,o)},o)}},"node"===d.env||!d.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(n=require.nodeRequire("fs"),t.get=function(e,t,a){try{var r=n.readFileSync(e,"utf8");"\ufeff"===r[0]&&(r=r.substring(1)),t(r)}catch(o){a&&a(o)}}):"xhr"===d.env||!d.env&&t.createXhr()?t.get=function(e,n,a,r){var o,i=t.createXhr();if(i.open("GET",e,!0),r)for(o in r)r.hasOwnProperty(o)&&i.setRequestHeader(o.toLowerCase(),r[o]);d.onXhr&&d.onXhr(i,e),i.onreadystatechange=function(t){var r,o;4===i.readyState&&(r=i.status||0,r>399&&600>r?(o=new Error(e+" HTTP status: "+r),o.xhr=i,a&&a(o)):n(i.responseText),d.onXhrComplete&&d.onXhrComplete(i,e))},i.send(null)}:"rhino"===d.env||!d.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,a,r="utf-8",o=new java.io.File(e),i=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),r)),l="";try{for(n=new java.lang.StringBuffer,a=s.readLine(),a&&a.length()&&65279===a.charAt(0)&&(a=a.substring(1)),null!==a&&n.append(a);null!==(a=s.readLine());)n.append(i),n.append(a);l=String(n.toString())}finally{s.close()}t(l)}:("xpconnect"===d.env||!d.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(a=Components.classes,r=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in a,t.get=function(e,t){var n,i,s,l={};o&&(e=e.replace(/\//g,"\\")),s=new FileUtils.File(e);try{n=a["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream),n.init(s,1,0,!1),i=a["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream),i.init(n,"utf-8",n.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),i.readString(n.available(),l),i.close(),n.close(),t(l.value)}catch(c){throw new Error((s&&s.path||"")+": "+c)}}),t});